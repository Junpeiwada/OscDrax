# OscDrax 実装計画書

## 運用ルール

### フェーズ管理
- 全6フェーズで段階的に開発
- 各フェーズは独立して実行・確認可能な単位で構成
- フェーズ完了時にはユーザーが実機で動作確認を実施
- ユーザーの承認を得てから次フェーズへ移行
- UIを優先的に構築し、その後機能を実装

### 進捗管理
- 各フェーズの開始時：TodoWriteツールでタスクを登録
- 作業中：タスクステータスを「in_progress」に更新
- 完了時：タスクステータスを「completed」に更新
- フェーズ完了時：チェックリストで確認

### ステータス記号
- ⬜ 未着手
- 🔄 作業中
- ✅ 完了
- ⏸️ 保留

---

## フェーズ1: プロジェクト設定とUI基本構造 ✅

### 目標
Xcodeプロジェクト作成、Liquidglass導入、基本UIレイアウト構築

### 主要タスク
- ✅ Xcodeプロジェクト作成
  - iOS App (SwiftUI)
  - Bundle ID: junpeiwada.com.OscDrax
  - iOS 17.0以上
  - Portrait only
- ✅ Liquidglass導入（カスタム実装）
- ✅ 基本UI構造
  - 4つのタブ（下部）
  - 波形表示エリア（上部）
  - コントロールエリア（中央）
- ✅ Info.plist設定（オーディオ権限）

### 成果物
- タブ切り替えが動作する基本UI
- Liquidglassスタイルが適用された画面

### 確認項目
- [x] アプリ起動確認
- [x] タブ切り替え動作
- [x] Liquidglassビジュアル確認

---

## フェーズ2: 波形表示とコントロールUI ✅

### 目標
波形表示ビューとすべてのコントロールUIを実装

### 主要タスク
- ✅ 波形表示ビュー
  - サイン波、三角波、矩形波の描画
  - プリセット選択（ハーフモーダル）
  - 各トラック独立表示
- ✅ コントロールUI
  - 周波数スライダー（20Hz-20kHz、対数スケール）
  - ボリュームスライダー（0-100%）
  - 再生/停止ボタン
  - 値表示ラベル
- ✅ 手描き波形機能
  - タッチジェスチャー認識
  - 512ポイント正規化
  - クリアボタン

### 成果物
- 波形が表示される（静的）
- スライダーが動作し値が表示
- 手描きで波形を描ける

### 確認項目
- [x] 3種類の波形表示
- [x] 手描き波形動作
- [x] UI操作の反応性

---

## フェーズ3: 基本オーディオエンジン ⬜

### 目標
単一トラックでの音声再生実装

### 主要タスク
- ⬜ AudioEngineクラス
  - AVAudioEngine設定
  - 別スレッド実行
  - バッファサイズ512サンプル
- ⬜ OscillatorTrackクラス
  - 波形テーブル生成（512ポイント）
  - サイン波音声生成
- ⬜ 基本制御
  - 再生/停止
  - 周波数変更（リアルタイム）
  - ボリューム調整

### 成果物
- サイン波の音が鳴る
- 周波数・ボリュームが変更可能
- UIがブロックされない

### 確認項目
- [ ] 音声再生確認
- [ ] パラメータ変更の反映
- [ ] UIレスポンス確認

---

## フェーズ4: 全波形対応とマルチトラック ⬜

### 目標
全波形種類の音声生成と4トラック同時再生

### 主要タスク
- ⬜ 波形種類拡張
  - 三角波、矩形波の音声生成
  - 手描き波形の音声化
  - 線形補間実装
- ⬜ マルチトラック
  - 4トラック管理
  - ミキシング処理（加算平均）
  - ソフトクリッピング（tanh）
- ⬜ パラメータ管理
  - ロックフリーキュー実装
  - 60Hz更新レート

### 成果物
- 全波形種類が音として再生
- 4トラック同時発音
- 手描き波形の音が鳴る

### 確認項目
- [ ] 各波形の音質
- [ ] 同時発音の安定性
- [ ] 音割れなし

---

## フェーズ5: ポルタメントとデータ永続化 ⬜

### 目標
ポルタメント機能実装と設定の保存/復元

### 主要タスク
- ⬜ ポルタメント機能
  - 周波数補間アルゴリズム
  - 時間設定（0-1000ms）
  - 各トラック個別設定
- ⬜ データ永続化
  - JSONデータモデル
  - 保存/読み込み処理
  - アプリ起動時の復元
  - アプリ終了時の保存
- ⬜ 手描き波形の保存

### 成果物
- 周波数が滑らかに変化
- アプリ再起動後も設定維持

### 確認項目
- [ ] ポルタメント動作
- [ ] データ保存/復元
- [ ] 手描き波形の永続化

---

## フェーズ6: 最終調整と品質向上 ⬜

### 目標
バグ修正、パフォーマンス最適化、UI/UX改善

### 主要タスク
- ⬜ パフォーマンス最適化
  - メモリリーク確認
  - CPU使用率最適化
  - 描画処理最適化
- ⬜ エラーハンドリング
  - オーディオセッション管理
  - 例外処理
- ⬜ UI/UX改善
  - アニメーション調整
  - レスポンス改善
  - Liquidglassスタイル微調整
- ⬜ 音質調整
  - ミキシングバランス
  - ノイズ除去

### 成果物
- 安定動作する完成版アプリ
- 快適なユーザー体験

### 確認項目
- [ ] 長時間動作テスト
- [ ] 全機能統合テスト
- [ ] 実機での最終確認

---

## 進捗サマリー

| フェーズ | 内容 | 状態 | 開始日 | 完了日 |
|---------|------|------|--------|--------|
| フェーズ1 | プロジェクト設定とUI基本構造 | ✅ | 2025-09-15 | 2025-09-15 |
| フェーズ2 | 波形表示とコントロールUI | ✅ | 2025-09-15 | 2025-09-15 |
| フェーズ3 | 基本オーディオエンジン | ⬜ | - | - |
| フェーズ4 | 全波形対応とマルチトラック | ⬜ | - | - |
| フェーズ5 | ポルタメントとデータ永続化 | ⬜ | - | - |
| フェーズ6 | 最終調整と品質向上 | ⬜ | - | - |

---

## マイルストーン

1. **フェーズ2完了時**: 完全なUIが動作（音なし）
2. **フェーズ3完了時**: 基本的な音が鳴る
3. **フェーズ4完了時**: 全機能が動作
4. **フェーズ6完了時**: リリース可能

## リスク管理

- **Liquidglass互換性**: フェーズ1で早期検証
- **オーディオ遅延**: フェーズ3で性能確認
- **メモリ使用**: フェーズ4でマルチトラック負荷確認

## 技術的注意点

- SwiftUIとAVAudioEngineの連携
- リアルタイム音声処理の最適化
- 手描き波形データの効率的な管理